package SGE;
use strict;

######################################################################
#
# SGE.pm bmajoros@duke.edu 9/12/2012
#
# 
# 
#
# Attributes:
#
# Methods:
#   $sge=new SGE();
#   $n=$sge->countJobs("substring");
#   
######################################################################


#---------------------------------------------------------------------
#                           PUBLIC METHODS
#---------------------------------------------------------------------
sub new
{
  my ($class)=@_;
  my $self={};
  my $id=`whoami`;
  chomp $id;
  $self->{userid}=$id;
  bless $self,$class;
  return $self;
}
#---------------------------------------------------------------------
#   $n=$sge->countJobs("substring");
sub countJobs
{
  my ($self,$pattern)=@_;
  my $id=$self->{userid};
  my $count=0;
  open(IN,"qstat -u $id |") || die $id;
  <IN>; <IN>;
  while(<IN>) {
    my @fields=split/\s+/,$_;
    my $state=$fields[4];
    next if $state=~/d/;
    #next unless $state eq "r" || $state eq "qw" || $state eq "t";
    my $jobName=$fields[2];
    if($jobName=~/$pattern/) {++$count}
  }
  close(IN);
  return $count;
}
#---------------------------------------------------------------------
#---------------------------------------------------------------------
#---------------------------------------------------------------------
#---------------------------------------------------------------------
#---------------------------------------------------------------------
#---------------------------------------------------------------------
#---------------------------------------------------------------------






#---------------------------------------------------------------------
#                         PRIVATE METHODS
#---------------------------------------------------------------------

1;

